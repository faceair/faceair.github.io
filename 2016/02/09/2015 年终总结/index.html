<!DOCTYPE html><html><head><meta name="generator" content="Hexo 3.8.0"><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/avatar.png"><link rel="alternate" type="application/rss+xml" title="faceair 的博客" href="https://faceair.me/atom.xml"><link rel="stylesheet" href="/styles.css"><title>2015 年终总结 | faceair 的博客</title></head><body><div class="container"><div class="columns page-header"><h1>faceair 的博客</h1></div><div class="columns"><div class="navigation clearfix"><nav class="left"><a href="/" class="favicon"><img alt="faceair 的博客" src="/avatar.png"></a><a href="/">首页</a><a href="/about-me/">关于我</a></nav><nav class="right"><a href="/atom.xml">RSS</a></nav></div></div><div class="columns"><div class="block-body column three-fourths"><article><header><h2>2015 年终总结</h2></header><div class="article-meta clearfix"><time class="left">2016 年 2 月 9 日</time><ul class="tags left"></ul><ul class="tags right"><li><a href="/tags/summary/">总结</a></li></ul></div><div class="markdown-body"><p>年初的时候还在对 helpful 修修补补，添加手机页面支持、国际化、附件上传和邮件订阅的相关工作。这个时候的我已经会用各种库来实现想要的功能了，对项目的整体架构有了一些认识，能按功能来划分模块，但对面对对象编程的理解还不够透彻。虽然我将 mongoose 作为 ORM 库来使用，但并没有彻底的理解 ORM 的好处。我曾一度不理解 mongoose 返回的 document 除了给人添堵、不能直接取键值以外到底有什么用，对数据的操作全部是用 collection model 上自带的方法完成的。感觉异常的别扭，但又不知道哪里不对劲。</p>
<p>直到三月中下旬开始接手重构 cashier 项目，看到代码里面通过 sequelize 实现的对表的抽象和对数据的抽象感觉打开了一道大门。原来 ORM 提供的是数据的抽象，每个数据实例不单单包含数据内容信息还包括了你期望的这个实例所具有的所有功能，比如一个文章的实例可以自带取作者信息和更新标题的方法。这个数据实例可以在不同模块直接传递，也可以直接调用数据实例上的方法，这样用简直太方便了，代码看起来清晰也容易理解。</p>
<p>cashier 是一个订单管理系统，毕竟跟钱相关需要对数据的可靠性做出保证，所以引入了数据库外键和事务。通过 sequelize 来定义表的关联，数据实例也很容易拿到它的关联数据。虽然是第一次使用事务，但我之前对事务略有耳闻知道是怎么回事。事务一般是将一组 SQL 串行执行，每条语句会带有操作条件，如果其中某个语句执行失败，所有的操作都会回滚。如果在执行事务的过程中程序 crash，事务最终没有被 commit，那这个事务所做的修改也不会被持久化。这样在断电或、程序 crash 等极端情况下或者并发操作同一条记录的情况下都能保证数据的一致和可靠性。</p>
<p>之前我一直是用 <a href="https://github.com/caolan/async" target="_blank" rel="noopener">async</a> 来搞定流程控制上的问题，没有什么问题，但是用的越多越感觉 callback 在处理 error 的时候实在太繁琐，几乎每个回调函数的首行都是 <code>if(err){callback(err)}</code> ，这样将错误一层一层往上抛，最后被调用者获取并处理。当不同的模块间相互调用太多的时候，错误处理就变得很麻烦。后来在 @jysperm 的影响下开始调研在 cashier 中用 Promise 来处理所有的异步流程，Promise 带来的好处就是统一了回调和错误处理流程。Promise 理解起来并不复杂，每个异步任务都返回一个 Promise 对象，这个对象有三种状态 <code>Pending</code>、<code>Fulfilled</code>、<code>Rejected</code>，then 方法接收回调函数和错误处理回调，catch 方法接收错误处理回调，Promise 可以链式执行，也就避免了回调地狱，代码看起来会清晰很多。</p>
<p>现在遇到的一个问题是是在 Promise 链式调用中无法中断执行流程，只能抛出一个特殊的异常来中断，感觉还是有点别扭。另一个问题是 node.js 标准库还没有支持 Promise，需要自己封装一遍，不过现在社区也在讨论<a href="https://github.com/nodejs/node/pull/5020" target="_blank" rel="noopener">将标准模块 Promise 化</a>的相关事情了。还值得注意的是 <a href="https://github.com/ysmood/yaku#compare-to-other-promise-libs" target="_blank" rel="noopener">Promise 不同的实现在性能上有比较大的差别</a>，可能换个 Promise 类库就能让你的程序速度快几倍。</p>
<p>当订单完成的时候需要给接入的网站发送异步通知和给用户发送订购邮件。这些异步任务的执行时长不定，很容易导致任务堆积和积压，如果执行失败要在合适的时间重试，如果重试失败也要通知开发者。如果不用队列的来处理，单独处理每个任务会很繁琐，也无法简单地横向拓展。最后根据 @orzfly 的建议最后选用了 resque 在 node.js 中的实现 <a href="https://github.com/taskrabbit/node-resque" target="_blank" rel="noopener">node-resque</a>，并通过 <a href="https://github.com/resque/resque-web" target="_blank" rel="noopener">resque-web</a> 来查看和管理异步任务。</p>
<p>五六月的时候梳理了 JavaScript 的原型继承相关概念，调研了 <a href="/2015/06/03/%E6%8B%92%E7%BB%9D%E5%A4%96%E9%83%A8%E4%BF%AE%E6%94%B9%E7%9A%84%E5%AF%B9%E8%B1%A1/">mongoose 里面的一些黑魔法</a>，为了实践一下还写了一个简易的 ORM 原型 <a href="https://github.com/faceair/cado" target="_blank" rel="noopener">cado</a>。ES6 中添加了 class 关键字作为构造函数的语法糖，比较像 CoffeeScript 了。</p>
<p>下半年大部分时间是花在了另一个项目 pomotodo-node 上了。项目虽说大一点，但是因为都模块化了所以整体的复杂度也没有很高，所用到的技术跟 cashier 差不太多，也没太多值得说的。</p>
<p>这一整年我都对网络相关很感兴趣，写了两个小东西 <a href="https://github.com/faceair/lyssa" target="_blank" rel="noopener">lyssa</a>、<a href="https://github.com/faceair/PowerProxy" target="_blank" rel="noopener">PowerProxy</a>。PowerProxy 是参考 <a href="https://itunes.apple.com/us/app/surge-web-developer-tool-proxy/id1040100637" target="_blank" rel="noopener">Surge</a> 和 <a href="http://anyproxy.io/cn/" target="_blank" rel="noopener">anyproxy</a> 实现的网络调试工具，主体是一个 HTTP Proxy Server ，通过中间人攻击 (自制证书) 方法注入 HTTPS 来嗅探所有请求，打算采用 <a href="http://electron.atom.io/" target="_blank" rel="noopener">electron</a> 制作跨平台应用。现在思路不是特别清晰，如果能把思路理顺应该会继续。</p>
<hr>
<p>考虑到五一黄金周人山人海，专门挑了五一前几天跟女朋友去庐山玩了一趟。蜿蜒曲折的山路、险峰，确实也别有一番风味。我们去的时候没有看到山雾，听导游说前几天都有的，总之是错过了。</p>
<p>本来我是不想学驾照的，我对无人驾驶汽车的未来还是很有信心的，人的反应速度和操作能力终归是比不上电脑的。不过依旧是没有拗过，暑假的时候在家里的一再劝说下开始考驾照，暑假学了有一个多月再加上后来又补考了科目三，最后在十一月的时候拿到了驾照。</p>
<p>我们大四有两门选修课，我学分差不多实在不想继续呆学校了，室友同学也开始出去找实习。我就搬到校外跟女朋友租房子住，开始了一起买菜做饭的日子，经过几个月的练习，现在我也能差不多做一些菜了。之前在学校经常是凌晨三四点睡觉的，现在也开始纠正自己的作息习惯了。这样远程工作的日子还是挺舒心的，每天睡到自然醒然后起床吃点东西干点活，有时候跟朋友一起开开黑打游戏，不用打卡不用朝九晚五。</p>
<p>十一月尾的时候 @顾惜朝 姐姐在知乎私信上问我想不想去知乎实习，我的天然后我后来居然就顺利通过了面试，在年底的时候像做梦一样就来到了北京。除了空气，北京的一切都还不错，在北京的具体生活我以后再写吧。</p>
<hr>
<p>感觉这一年像是分水岭，终于离开了学校，开始了新的生活。</p>
</div></article></div><div class="block-sidebar column one-fourth"><div class="widget tags"><ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/">Linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nodejs/">Node.js</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/php/">PHP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/summary/">总结</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/network/">网络</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/speech/">讲稿</a></li></ul></div><div class="widget archives"><ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/01/">一月 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/12/">十二月 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/11/">十一月 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/02/">二月 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/06/">六月 2015</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/05/">五月 2015</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/12/">十二月 2014</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/09/">九月 2014</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/02/">二月 2014</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/12/">十二月 2013</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/11/">十一月 2013</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/03/">三月 2013</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/09/">九月 2011</a><span class="archive-list-count">1</span></li></ul></div><div class="widget text-content"><p>博客内容使用&nbsp;<a href="http://creativecommons.org/licenses/by-nc-sa/3.0/cn">CC BY-NC-SA 3.0</a>&nbsp;授权发布。
<br>
Powered&nbsp;by&nbsp;<a href="http://hexo.io">Hexo</a>&nbsp;&&nbsp;<a href="https://github.com/jysperm/hexo-theme-simpleblock">SimpleBlock</a>&nbsp;.</p></div></div></div></div></body></html>