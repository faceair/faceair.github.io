<!DOCTYPE html><html><head><meta name="generator" content="Hexo 3.8.0"><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/avatar.png"><link rel="alternate" type="application/rss+xml" title="faceair 的博客" href="https://faceair.me/atom.xml"><link rel="stylesheet" href="/styles.css"><title>理解 Node.js 异步编程 | faceair 的博客</title></head><body><div class="container"><div class="columns page-header"><h1>faceair 的博客</h1></div><div class="columns"><div class="navigation clearfix"><nav class="left"><a href="/" class="favicon"><img alt="faceair 的博客" src="/avatar.png"></a><a href="/">首页</a><a href="/about-me/">关于我</a></nav><nav class="right"><a href="/atom.xml">RSS</a></nav></div></div><div class="columns"><div class="block-body column three-fourths"><article><header><h2>理解 Node.js 异步编程</h2></header><div class="article-meta clearfix"><time class="left">2014 年 9 月 15 日</time><ul class="tags left"></ul><ul class="tags right"><li><a href="/tags/nodejs/">Node.js</a></li></ul></div><div class="markdown-body"><h2 id="事件队列"><a href="#事件队列" class="headerlink" title="事件队列"></a>事件队列</h2><p>JavaScript 是单线程设计，任务的调度方式就是队列。即在运行过程中只有一个线程在运行，也就是说每次只能执行一个任务。当调用 <code>setTimeout</code> 这种异步函数的时候，会将控制权交给通信线程，其中的回调不会立即执行。而当调用赋值等同步语句的时候，会立即执行。JavaScript 虚拟机会轮询这个队列，执行合适的事件。</p>
<p>这样做有什么好处呢？</p>
<p>不用新开线程，减轻系统开销，再多的并发也只是加长了事件队列，也不会令执行混乱。</p>
<h2 id="异步IO"><a href="#异步IO" class="headerlink" title="异步IO"></a>异步IO</h2><p>一般同步执行的的 Web 程序中操作 IO 的函数总是执行时间最长的，当网络和存储技术不发生大的革新的情况下，异步IO 是一个提升响应速度的好办法。</p>
<p>同步IO 就是在执行 IO 操作的时候线程阻塞，不继续向下执行，而是一直等待这个 IO 操作的返回。 而当 JavaScript 虚拟机调用了异步IO函数以后，不会等待函数的返回，而是继续执行下一个事件。</p>
<p>那什么怎么知道异步函数执行完了呢？</p>
<p>IO 操作是另外的通信线程来实现的，通信线程操作结束后会将执行原始回调函数的引用加入到 JavaScript 事件队列中，JavaScript 虚拟机因为一直在轮询这个事件队列，会发现这个事件并完成后续的处理。对于 Node.js 应用而言，它是部分多线程，即非阻塞IO 为多线程，但是 IO 结果的处理还是单线程执行。</p>
<p>所以 Node.js 的执行过程能保证非常的迅速。</p>
<h2 id="回调函数"><a href="#回调函数" class="headerlink" title="回调函数"></a>回调函数</h2><p>回调函数也是一个函数，只不过它的调用方式跟普通的函数不一样，它是由事件驱动的。比如完成个某个IO 操作以后执行回调，那么这个回调这是由完成事件来触发的。</p>
<p>人脑最自然的思考方式是顺序执行，非常适合写同步代码。而异步理解起来会比较绕，你需要将下一个执行的事件封装成一个回调函数，然后当一个参数传递给异步函数。异步函数在完成它自己的操作以后再执行这个回调函数，而这个回调函数里面又可能有其他异步函数，里面也有回调函数，所以整个执行过程看起来会比较像一个金字塔。</p>
<p>比较合理的做法是将不同的回调封装成函数，在异步函数里面只做调用，这样代码的结构会清晰很多。但有时候还是会造成一些混乱，所以也有 <a href="https://github.com/kriskowal/q" target="_blank" rel="noopener">Q</a> 和 <a href="https://github.com/caolan/async" target="_blank" rel="noopener">async</a> 这些来填坑的库。</p>
</div></article></div><div class="block-sidebar column one-fourth"><div class="widget tags"><ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/">Linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nodejs/">Node.js</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/php/">PHP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/summary/">总结</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/network/">网络</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/speech/">讲稿</a></li></ul></div><div class="widget archives"><ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/01/">一月 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/12/">十二月 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/11/">十一月 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/02/">二月 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/06/">六月 2015</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/05/">五月 2015</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/12/">十二月 2014</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/09/">九月 2014</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/02/">二月 2014</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/12/">十二月 2013</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/11/">十一月 2013</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/03/">三月 2013</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/09/">九月 2011</a><span class="archive-list-count">1</span></li></ul></div><div class="widget text-content"><p>博客内容使用&nbsp;<a href="http://creativecommons.org/licenses/by-nc-sa/3.0/cn">CC BY-NC-SA 3.0</a>&nbsp;授权发布。
<br>
Powered&nbsp;by&nbsp;<a href="http://hexo.io">Hexo</a>&nbsp;&&nbsp;<a href="https://github.com/jysperm/hexo-theme-simpleblock">SimpleBlock</a>&nbsp;.</p></div></div></div></div></body></html>